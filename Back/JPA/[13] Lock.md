# [13] Lock

## 정의
* 낙관적락, 비관적락
* 트랜잭션의 충돌 발생 가능 여부


## 낙관적락
* 트랜잭션 충돌이 발생하지 않는다고 낙관적으로 가정하는 방법.
* JPA 제공하는 버전 관리 기능.
* 트랜잭션을 커밋하기 전까지 충돌을 알 수 없음.


## 비관적락
* 트랜잭션 충돌이 발생한다고 비관적으로 가정하는 방법.
* 데이터베이스가 제공하는 락 기능.


## @Version


## 낙관적락 동작
1. A트랜잭션이 emp테이블의 emp_no = 1 값을 가져온다. 이때 version은 0이다.
2. B트랜잭션이 emp테이블의 emp_no = 1 값을 가져온다. 이때 version은 0이다.
3. A트랜잭션이 조회한 엔티티를 변경하여 커밋한다.
> 커밋하기 전에 JPA에서는 version을 확인해 본다. 현재 엔티티의 version과 DB의 version 값이 같은지
> 엔티티 버전와 DB 버전이 같다면 emp 테이블의 version 컬럼에 1로 업데이트 한다.
4. B트랜잭션이 조회한 엔티티를 변경하여 커밋한다. 
> 커밋하기 전에 version을 확인한다.
> 예외를 발생시킨다.


## 비관적락 동작
1. A트랜잭션이 emp테이블을 락을 걸고 조회한다.
2. B트랜잭션이 변경할 때 예외를 발생시킨다.